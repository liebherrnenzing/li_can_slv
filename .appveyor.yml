
version: 1.0.0-{build}
image: Visual Studio 2019

branches:
  only:
    - master
    - dev

cache:
  - '%LOCALAPPDATA%\pip\Cache'

environment:
  matrix:
    - PYTHON: C:\Python37-x64
      MINGW: C:\MinGW\bin

init:
  # Make sure Python is first in PATH for all steps
  - cmd: SETX PATH "%PYTHON%;%PYTHON%\Scripts;%PATH%"

install:
  - choco install mingw --version=11.2.0
  - refreshenv
  - python -m pip install --upgrade pip
  - pip install -r requirements.txt
  - pip install codecov
  - cmd: mklink /D C:\MinGW C:\ProgramData\chocolatey

build_script:
  - cmd: where python
  - cmd: python --version
  - cmd: where gcc
  - cmd: gcc --version
  - inv configure
  - inv all

test_script:
  - inv test

after_test:
  - inv cov
  - cd build\coverage
